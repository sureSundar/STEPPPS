<!DOCTYPE html>
<html>
<head>
    <title>STEPPPS - Revolutionary Pixel Intelligence</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.8em;
            margin: 0;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .config-panel {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }
        .button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .test-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        .pixel-canvas {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .pixel-canvas h3 {
            color: #333;
            text-align: center;
            margin-top: 0;
            font-size: 1.3em;
        }
        #canvas {
            border: 3px solid #ddd;
            border-radius: 12px;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
            transition: border-color 0.3s ease;
        }
        #canvas:hover {
            border-color: #4ecdc4;
        }
        .intelligence-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            max-height: 650px;
            overflow-y: auto;
        }
        .intelligence-panel h3 {
            margin-top: 0;
            color: #4ecdc4;
            font-size: 1.3em;
        }
        .pixel-data {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        .ai-response {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
            padding: 18px;
            margin: 15px 0;
            border-radius: 0 12px 12px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        .loading {
            color: #ffc107;
            font-style: italic;
        }
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        .stat-box:hover {
            transform: translateY(-2px);
        }
        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            color: #4ecdc4;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ STEPPPS Protocol</h1>
            <p><strong>Revolutionary Pixel Intelligence - Every Pixel Becomes an AI Agent</strong></p>
            <p>FastAPI + Claude AI Integration</p>
        </div>

        <div class="config-panel">
            <h3>üîß Claude AI Configuration</h3>
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: end;">
                <div class="input-group">
                    <label>Claude API Key</label>
                    <input type="password" id="apiKey" placeholder="Enter your Claude API key (sk-ant-...)">
                </div>
                <div>
                    <button class="button" onclick="testConnection()">üß™ Test Connection</button>
                </div>
            </div>
            <div id="connectionStatus"></div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-number" id="pixelCount">0</div>
                <div class="stat-label">Intelligent Pixels</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="aiInteractions">0</div>
                <div class="stat-label">AI Conversations</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="avgResponseTime">0ms</div>
                <div class="stat-label">Response Time</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="intelligenceLevel">0%</div>
                <div class="stat-label">Intelligence Level</div>
            </div>
        </div>

        <div class="test-area">
            <div class="pixel-canvas">
                <h3>üé® Intelligent Canvas - Click Any Pixel</h3>
                <canvas id="canvas" width="550" height="380"></canvas>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button" onclick="loadSampleImage()">üñºÔ∏è Load Rich Sample</button>
                    <button class="button" onclick="clearCanvas()">üßπ Clear Canvas</button>
                    <button class="button" onclick="analyzeRandomPixels()">üé≤ Random Analysis</button>
                </div>
            </div>

            <div class="intelligence-panel">
                <h3>üß† Pixel Intelligence Feed</h3>
                <div id="intelligenceLog"></div>
            </div>
        </div>
    </div>

    <script>
        // STEPPPS Framework
        class STEPPPSPixel {
            constructor(x, y, canvas) {
                this.space = {
                    coordinates: [x, y],
                    canvas_size: [canvas.width, canvas.height],
                    region: this.determineRegion(x, y, canvas)
                };

                this.pixel = {
                    color: this.getPixelColor(x, y, canvas),
                    rgba: [0, 0, 0, 0],
                    luminance: 0,
                    saturation: 0
                };

                this.updatePixelProperties(x, y, canvas);
            }

            determineRegion(x, y, canvas) {
                const quadW = canvas.width / 3;
                const quadH = canvas.height / 3;

                if (x < quadW && y < quadH) return 'top-left';
                if (x > quadW * 2 && y < quadH) return 'top-right';
                if (x < quadW && y > quadH * 2) return 'bottom-left';
                if (x > quadW * 2 && y > quadH * 2) return 'bottom-right';
                if (y < quadH) return 'top-center';
                if (y > quadH * 2) return 'bottom-center';
                if (x < quadW) return 'left-center';
                if (x > quadW * 2) return 'right-center';
                return 'center';
            }

            getPixelColor(x, y, canvas) {
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(x, y, 1, 1);
                const [r, g, b, a] = imageData.data;
                this.pixel.rgba = [r, g, b, a];
                this.pixel.luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
                this.pixel.saturation = this.calculateSaturation(r, g, b);
                return `rgba(${r}, ${g}, ${b}, ${a/255})`;
            }

            calculateSaturation(r, g, b) {
                const max = Math.max(r, g, b) / 255;
                const min = Math.min(r, g, b) / 255;
                return max === 0 ? 0 : (max - min) / max;
            }

            updatePixelProperties(x, y, canvas) {
                this.pixel.color = this.getPixelColor(x, y, canvas);
            }

            generatePrompt() {
                return `You are an intelligent pixel in the revolutionary STEPPPS protocol at coordinates (${this.space.coordinates[0]}, ${this.space.coordinates[1]}) in the ${this.space.region} region.

Your properties:
- Color: ${this.pixel.color}
- Luminance: ${(this.pixel.luminance * 100).toFixed(1)}%
- Saturation: ${(this.pixel.saturation * 100).toFixed(1)}%

As this intelligent pixel, analyze your role in the visual composition. What do you represent? How do you contribute to the user's exploration experience? Respond as the pixel itself in 2-3 creative, contextual sentences that demonstrate your intelligence and awareness.`;
            }

            async getAIResponse() {
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) {
                    throw new Error('Please enter your Claude API key');
                }

                const response = await fetch('http://localhost:9000/api/claude', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        api_key: apiKey,
                        request_data: {
                            model: 'claude-3-5-sonnet-20241022',
                            max_tokens: 200,
                            messages: [{
                                role: 'user',
                                content: this.generatePrompt()
                            }]
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'API request failed');
                }

                const data = await response.json();
                return data.content[0].text;
            }
        }

        // Global State
        let intelligentPixels = new Map();
        let totalInteractions = 0;
        let responseTimes = [];
        let canvas, ctx;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            canvas.addEventListener('click', handlePixelClick);
            loadSampleImage();
            updateStats();
            logIntelligence('üöÄ STEPPPS FastAPI Protocol initialized!');
            logIntelligence('üí° Every pixel can now become an intelligent AI agent');
            logIntelligence('üéØ Click any pixel to see Claude AI analyze its role and context');
        });

        async function testConnection() {
            const status = document.getElementById('connectionStatus');
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                status.innerHTML = '<div class="error">‚ö†Ô∏è Please enter your Claude API key first</div>';
                return;
            }

            if (!apiKey.startsWith('sk-ant-')) {
                status.innerHTML = '<div class="error">‚ùå Invalid API key format. Must start with sk-ant-</div>';
                return;
            }

            status.innerHTML = '<div class="loading">üîÑ Testing FastAPI connection to Claude AI...</div>';

            try {
                const response = await fetch('http://localhost:9000/api/claude', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        api_key: apiKey,
                        request_data: {
                            model: 'claude-3-5-sonnet-20241022',
                            max_tokens: 50,
                            messages: [{
                                role: 'user',
                                content: 'Say "STEPPPS Protocol Ready!" and confirm you can analyze intelligent pixels.'
                            }]
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    status.innerHTML = `<div class="error">‚ùå ${errorData.detail}</div>`;
                    return;
                }

                const data = await response.json();
                status.innerHTML = `<div class="success">‚úÖ FastAPI + Claude Success!
                <br><strong>Claude says:</strong> "${data.content[0].text}"
                <br>üéâ Ready for revolutionary pixel intelligence!</div>`;

            } catch (error) {
                status.innerHTML = `<div class="error">‚ùå Connection failed: ${error.message}</div>`;
            }
        }

        async function handlePixelClick(event) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor(event.clientX - rect.left);
            const y = Math.floor(event.clientY - rect.top);

            const pixel = new STEPPPSPixel(x, y, canvas);
            intelligentPixels.set(\`\${x},\${y}\`, pixel);

            // Enhanced visual feedback
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, 2 * Math.PI);
            ctx.fillStyle = 'rgba(255, 255, 0, 0.8)';
            ctx.fill();
            ctx.strokeStyle = 'rgba(255, 0, 0, 1)';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Add pulsing effect
            let pulseSize = 8;
            const pulseInterval = setInterval(() => {
                if (pulseSize > 15) {
                    clearInterval(pulseInterval);
                    return;
                }
                ctx.beginPath();
                ctx.arc(x, y, pulseSize, 0, 2 * Math.PI);
                ctx.strokeStyle = \`rgba(255, 255, 0, \${0.8 - (pulseSize - 8) / 10})\`;
                ctx.lineWidth = 2;
                ctx.stroke();
                pulseSize += 1;
            }, 50);

            logIntelligence(\`üéØ Intelligent pixel created at (\${x}, \${y}) in \${pixel.space.region}\`);
            logIntelligence(\`üìä Properties: \${pixel.pixel.color}, Luminance=\${(pixel.pixel.luminance*100).toFixed(1)}%, Saturation=\${(pixel.pixel.saturation*100).toFixed(1)}%\`);

            try {
                logIntelligence(\`üß† Requesting Claude analysis via FastAPI...\`);
                const startTime = performance.now();
                const aiResponse = await pixel.getAIResponse();
                const endTime = performance.now();

                responseTimes.push(endTime - startTime);
                totalInteractions++;

                logIntelligence(\`‚ú® Claude as Pixel (\${x}, \${y}): \${aiResponse}\`);
            } catch (error) {
                logIntelligence(\`‚ùå AI Analysis failed: \${error.message}\`);
            }

            updateStats();
        }

        function loadSampleImage() {
            // Create rich, complex sample image
            const gradient1 = ctx.createRadialGradient(150, 150, 0, 150, 150, 120);
            gradient1.addColorStop(0, '#ff6b6b');
            gradient1.addColorStop(0.4, '#4ecdc4');
            gradient1.addColorStop(0.8, '#45b7d1');
            gradient1.addColorStop(1, '#96ceb4');

            const gradient2 = ctx.createLinearGradient(300, 0, 550, 380);
            gradient2.addColorStop(0, '#feca57');
            gradient2.addColorStop(0.3, '#ff9ff3');
            gradient2.addColorStop(0.7, '#54a0ff');
            gradient2.addColorStop(1, '#5f27cd');

            // Background
            ctx.fillStyle = gradient2;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Overlay gradient
            ctx.fillStyle = gradient1;
            ctx.fillRect(50, 50, 200, 200);

            // Geometric shapes with interesting colors
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(180, 280, 45, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#2c2c54';
            ctx.fillRect(320, 220, 120, 80);

            ctx.fillStyle = '#ff3838';
            ctx.beginPath();
            ctx.moveTo(450, 120);
            ctx.lineTo(490, 180);
            ctx.lineTo(410, 180);
            ctx.closePath();
            ctx.fill();

            // Text element
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 28px Arial';
            ctx.fillText('STEPPPS', 350, 320);

            // Organic shapes
            ctx.fillStyle = '#26de81';
            ctx.beginPath();
            ctx.ellipse(480, 290, 60, 35, Math.PI / 4, 0, 2 * Math.PI);
            ctx.fill();

            // Artistic elements
            ctx.fillStyle = '#fd79a8';
            ctx.beginPath();
            ctx.arc(100, 320, 25, 0, 2 * Math.PI);
            ctx.fill();

            logIntelligence('üñºÔ∏è Rich sample image loaded with multiple visual elements');
            logIntelligence('üé® Gradients, shapes, text, and artistic elements ready for intelligent exploration');
            logIntelligence('üí° Each pixel region will provide unique AI insights based on its visual context');
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const bgGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            bgGradient.addColorStop(0, '#f8f9fa');
            bgGradient.addColorStop(1, '#e9ecef');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            intelligentPixels.clear();
            totalInteractions = 0;
            responseTimes = [];
            document.getElementById('intelligenceLog').innerHTML = '';
            logIntelligence('üßπ Canvas cleared - Ready for new intelligent pixel exploration');
            updateStats();
        }

        async function analyzeRandomPixels() {
            logIntelligence('üé≤ Analyzing 4 random pixels for pattern discovery...');
            for (let i = 0; i < 4; i++) {
                const x = Math.floor(Math.random() * canvas.width);
                const y = Math.floor(Math.random() * canvas.height);
                setTimeout(() => {
                    const rect = canvas.getBoundingClientRect();
                    handlePixelClick({
                        clientX: rect.left + x,
                        clientY: rect.top + y
                    });
                }, i * 2500);
            }
        }

        function logIntelligence(message) {
            const log = document.getElementById('intelligenceLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');

            if (message.includes('‚ú®') || message.includes('Claude as Pixel')) {
                entry.className = 'ai-response';
            } else if (message.includes('‚ùå')) {
                entry.className = 'error';
            } else {
                entry.className = 'pixel-data';
            }

            entry.innerHTML = \`<strong>[\${timestamp}]</strong> \${message}\`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            // Add pulse effect to stats when AI responds
            if (message.includes('‚ú®')) {
                document.querySelector('.stats').classList.add('pulse');
                setTimeout(() => {
                    document.querySelector('.stats').classList.remove('pulse');
                }, 2000);
            }
        }

        function updateStats() {
            document.getElementById('pixelCount').textContent = intelligentPixels.size;
            document.getElementById('aiInteractions').textContent = totalInteractions;

            const avgTime = responseTimes.length > 0
                ? Math.round(responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length)
                : 0;
            document.getElementById('avgResponseTime').textContent = avgTime + 'ms';

            const intelligence = intelligentPixels.size > 0
                ? Math.round((totalInteractions / intelligentPixels.size) * 100)
                : 0;
            document.getElementById('intelligenceLevel').textContent = Math.min(100, intelligence) + '%';
        }
    </script>
</body>
</html>