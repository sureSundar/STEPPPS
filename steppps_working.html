<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEPPPS Protocol with Working LLM Integration</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff41;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .config-panel {
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid #00ff41;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .config-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .config-input, select, input[type="text"], input[type="password"], input[type="file"] {
            background: rgba(0, 255, 65, 0.2);
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 8px;
            font-size: 12px;
        }
        
        .canvas-section {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .canvas-container {
            position: relative;
        }
        
        .steppps-canvas {
            border: 2px solid #00ff41;
            background: #000;
            cursor: crosshair;
        }
        
        .ai-panel {
            width: 400px;
            background: #000;
            border: 2px solid #ff0041;
            padding: 15px;
            font-size: 11px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(0, 255, 65, 0.3);
        }
        
        .control-btn.primary {
            background: rgba(255, 0, 65, 0.2);
            border-color: #ff0041;
            color: #ff0041;
            font-weight: bold;
        }
        
        .ai-response {
            background: rgba(255, 0, 65, 0.1);
            border-left: 3px solid #ff0041;
            padding: 8px;
            margin: 5px 0;
            font-size: 11px;
            word-wrap: break-word;
        }
        
        .pixel-data {
            background: rgba(0, 100, 255, 0.1);
            border-left: 3px solid #0064ff;
            padding: 10px;
            margin: 5px 0;
            font-size: 10px;
        }
        
        .status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .status.success { background: rgba(0, 255, 0, 0.2); color: #00ff00; }
        .status.error { background: rgba(255, 0, 0, 0.2); color: #ff0000; }
        .status.warning { background: rgba(255, 255, 0, 0.2); color: #ffff00; }
        
        .cors-notice {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
            color: #ffa500;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>STEPPPS Protocol with LLM Integration</h1>
            <h2>Real AI Intelligence for Every Pixel</h2>
        </div>
        
        <!-- LLM Configuration Panel -->
        <div class="config-panel">
            <h3>üß† LLM CONFIGURATION</h3>
            <div class="config-row">
                <label>Provider:</label>
                <select id="llmProvider">
                    <option value="claude">Claude (Anthropic)</option>
                    <option value="openai">OpenAI GPT</option>
                    <option value="ollama">Ollama (Local)</option>
                </select>
                
                <label>Model:</label>
                <input type="text" id="llmModel" style="width: 200px;" 
                       value="claude-sonnet-4-20250514">
            </div>
            <div class="config-row">
                <label>API Key:</label>
                <input type="password" id="apiKey" style="width: 300px;" 
                       placeholder="No API key needed for Claude in this environment">
                
                <button class="control-btn" id="testBtn">üß™ Test LLM</button>
                <button class="control-btn" id="saveBtn">üíæ Save Config</button>
            </div>
            
            <div class="cors-notice">
                ‚úÖ <strong>Good News:</strong> Claude API works directly in this environment!
                Just click "Test LLM" to verify the connection.
            </div>
            
            <div id="llmStatus" class="status"></div>
        </div>
        
        <!-- Image Upload Panel -->
        <div class="config-panel">
            <h3>üìÅ IMAGE UPLOAD</h3>
            <div class="config-row">
                <input type="file" id="imageFile" accept="image/*">
                <button class="control-btn" id="sampleBtn">üñºÔ∏è Load Sample</button>
                <button class="control-btn" id="clearBtn">üßπ Clear</button>
            </div>
            <div id="uploadStatus" class="status"></div>
        </div>
        
        <!-- Main Canvas and AI Panel -->
        <div class="canvas-section">
            <div class="canvas-container">
                <canvas class="steppps-canvas" id="stepppsCanvas" width="800" height="600"></canvas>
                <div style="margin-top: 10px; color: #0099ff; font-size: 12px;">
                    <strong>Canvas:</strong> <span id="canvasInfo">800x600 = 480,000 pixels</span><br>
                    <strong>Intelligent:</strong> <span id="intelligentCount">0</span> | 
                    <strong>AI Analyzed:</strong> <span id="aiAnalyzedCount">0</span>
                </div>
            </div>
            
            <div class="ai-panel">
                <h3 style="color: #ff0041; margin-top: 0;">ü§ñ AI Analysis Panel</h3>
                <div id="aiResponses">
                    <div class="ai-response">
                        üéØ <strong>Ready for AI Analysis!</strong><br><br>
                        <strong>Instructions:</strong><br>
                        1. Click "Test LLM" to verify Claude connection<br>
                        2. Upload image or load sample<br>
                        3. Click any pixel for AI analysis<br>
                        4. Watch real AI responses appear here!<br><br>
                        <strong>Built-in Claude Support!</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <button class="control-btn primary" id="processBtn">
                üì≤ MAKE ALL PIXELS INTELLIGENT
            </button>
            <button class="control-btn" id="randomBtn">
                üß† ANALYZE 10 RANDOM PIXELS
            </button>
            <button class="control-btn" id="exportBtn">
                üíæ Export Data
            </button>
            <button class="control-btn" id="statsBtn">
                üìä Show Stats
            </button>
        </div>
        
        <!-- Selected Pixel Data -->
        <div class="config-panel">
            <h3>üéØ SELECTED PIXEL DATA</h3>
            <div id="selectedPixelData" class="pixel-data">
                Click on any pixel to see its complete STEPPPS data with AI analysis...
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let canvas, ctx, pixelMatrix, deviceId, llmConfig, stats;
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeSTEPPPS();
            setupEventListeners();
        });
        
        function initializeSTEPPPS() {
            console.log('[STEPPPS] Starting initialization...');
            
            // Initialize canvas
            canvas = document.getElementById('stepppsCanvas');
            ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            
            // Initialize data structures
            pixelMatrix = new Map();
            deviceId = 'STEPPPS_' + Date.now();
            stats = { intelligent: 0, aiAnalyzed: 0 };
            
            // Initialize LLM config
            llmConfig = {
                provider: 'claude',
                model: 'claude-sonnet-4-20250514',
                apiKey: '',
                isConfigured: false
            };
            
            // Setup canvas with a sample gradient
            setupCanvas();
            
            // Show initial message
            addAIResponse('üöÄ STEPPPS Protocol initialized successfully!');
            addAIResponse('üí° Click "Test LLM" to verify Claude API connection!');
            console.log('[STEPPPS] Initialized successfully');
        }
        
        function setupEventListeners() {
            // Canvas click
            canvas.addEventListener('click', handleCanvasClick);
            
            // Button events
            document.getElementById('testBtn').addEventListener('click', handleTestLLM);
            document.getElementById('saveBtn').addEventListener('click', handleSaveConfig);
            document.getElementById('sampleBtn').addEventListener('click', handleLoadSample);
            document.getElementById('clearBtn').addEventListener('click', handleClearCanvas);
            document.getElementById('processBtn').addEventListener('click', handleProcessAll);
            document.getElementById('randomBtn').addEventListener('click', handleAnalyzeRandom);
            document.getElementById('exportBtn').addEventListener('click', handleExportData);
            document.getElementById('statsBtn').addEventListener('click', handleShowStats);
            
            // File input
            document.getElementById('imageFile').addEventListener('change', handleImageChange);
            
            // Provider selector
            document.getElementById('llmProvider').addEventListener('change', handleProviderChange);
        }
        
        function setupCanvas() {
            // Create a sample gradient for demonstration
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#001122');
            gradient.addColorStop(0.5, '#002244');
            gradient.addColorStop(1, '#000011');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add some sample elements
            ctx.fillStyle = '#ff4444';
            ctx.fillRect(100, 100, 50, 50);
            
            ctx.fillStyle = '#44ff44';
            ctx.fillRect(200, 200, 30, 30);
            
            ctx.fillStyle = '#4444ff';
            ctx.beginPath();
            ctx.arc(400, 300, 25, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // Button Handler Functions
        function handleTestLLM() {
            console.log('[STEPPPS] Testing LLM...');
            saveLLMConfigFromUI();
            testLLMConnection();
        }
        
        function handleSaveConfig() {
            saveLLMConfigFromUI();
            showStatus('llmStatus', 'üíæ Configuration saved!', 'success');
        }
        
        function handleLoadSample() {
            setupCanvas();
            showStatus('uploadStatus', '‚úÖ Sample image loaded!', 'success');
            addAIResponse('üñºÔ∏è Sample gradient pattern loaded for testing');
        }
        
        function handleClearCanvas() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            pixelMatrix.clear();
            stats = { intelligent: 0, aiAnalyzed: 0 };
            updateStats();
            showStatus('uploadStatus', 'üßπ Canvas cleared!', 'success');
            addAIResponse('üßπ Canvas cleared and data reset');
        }
        
        async function handleProcessAll() {
            if (!llmConfig.isConfigured) {
                addAIResponse('‚ö†Ô∏è Please test LLM connection first!');
                return;
            }
            
            addAIResponse('üì≤ Processing sample pixels with STEPPPS intelligence...');
            
            const sampleSize = 50;
            for (let i = 0; i < sampleSize; i++) {
                const x = Math.floor(Math.random() * canvas.width);
                const y = Math.floor(Math.random() * canvas.height);
                createPixelSTEPPPS(x, y, 'batch_process');
                
                if (i % 10 === 0) {
                    updateStats();
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }
            
            updateStats();
            addAIResponse(`‚úÖ Processed ${sampleSize} pixels with STEPPPS intelligence!`);
        }
        
        async function handleAnalyzeRandom() {
            if (!llmConfig.isConfigured) {
                addAIResponse('‚ö†Ô∏è Please test LLM connection first!');
                return;
            }
            
            addAIResponse('üß† Analyzing 5 random pixels with AI...');
            
            for (let i = 0; i < 5; i++) {
                const x = Math.floor(Math.random() * canvas.width);
                const y = Math.floor(Math.random() * canvas.height);
                
                try {
                    await analyzePixelWithAI(x, y);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } catch (error) {
                    addAIResponse(`‚ùå Failed to analyze pixel (${x}, ${y}): ${error.message}`);
                }
            }
            
            addAIResponse('‚úÖ Random pixel analysis complete!');
        }
        
        function handleExportData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                device_id: deviceId,
                canvas_dimensions: { width: canvas.width, height: canvas.height },
                stats: stats,
                pixels: Array.from(pixelMatrix.entries()).map(([key, data]) => ({
                    key: key,
                    data: data
                }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `steppps_data_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            addAIResponse(`üíæ Exported ${pixelMatrix.size} pixels of STEPPPS data`);
        }
        
        function handleShowStats() {
            const totalPixels = canvas.width * canvas.height;
            const intelligentPercent = ((stats.intelligent / totalPixels) * 100).toFixed(4);
            const aiPercent = ((stats.aiAnalyzed / totalPixels) * 100).toFixed(4);
            
            addAIResponse(`üìä STEPPPS Statistics:
‚Ä¢ Total Canvas Pixels: ${totalPixels.toLocaleString()}
‚Ä¢ Intelligent Pixels: ${stats.intelligent} (${intelligentPercent}%)
‚Ä¢ AI Analyzed Pixels: ${stats.aiAnalyzed} (${aiPercent}%)
‚Ä¢ Device ID: ${deviceId}
‚Ä¢ LLM Provider: ${llmConfig.provider}
‚Ä¢ Active Since: ${new Date(parseInt(deviceId.split('_')[1])).toLocaleString()}`);
        }
        
        function handleImageChange(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        showStatus('uploadStatus', '‚úÖ Image loaded successfully!', 'success');
                        addAIResponse(`üì∏ Image loaded: ${file.name}`);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleProviderChange() {
            const provider = document.getElementById('llmProvider').value;
            llmConfig.provider = provider;
            addAIResponse(`üîÑ Switched to ${provider} provider`);
        }
        
        // Configuration Functions
        function saveLLMConfigFromUI() {
            llmConfig.provider = document.getElementById('llmProvider').value;
            llmConfig.model = document.getElementById('llmModel').value;
            llmConfig.apiKey = document.getElementById('apiKey').value;
            
            localStorage.setItem('steppps_llm_config', JSON.stringify(llmConfig));
            console.log('[STEPPPS] Config saved:', llmConfig.provider, llmConfig.model);
        }
        
        async function testLLMConnection() {
            showStatus('llmStatus', 'üß™ Testing REAL Claude API...', 'warning');
            addAIResponse('üß™ Attempting REAL Claude API connection...');
            addAIResponse('üîç Checking for API access in this environment...');
            
            try {
                const testPrompt = 'Respond with exactly: "STEPPPS Real Claude API Success!"';
                const response = await queryClaude(testPrompt);
                
                if (response) {
                    llmConfig.isConfigured = true;
                    showStatus('llmStatus', 'üéâ REAL Claude API Connected!', 'success');
                    addAIResponse(`üéâ SUCCESS! Real Claude API working!`);
                    addAIResponse(`üìù Claude responded: "${response}"`);
                    addAIResponse('‚úÖ You now have GENUINE AI intelligence for every pixel!');
                    addAIResponse('üéØ Click any pixel to get real Claude analysis!');
                } else {
                    throw new Error('No response received from Claude API');
                }
                
            } catch (error) {
                llmConfig.isConfigured = false;
                showStatus('llmStatus', `‚ùå Real API Access Issue`, 'error');
                addAIResponse(`‚ùå Claude API Error: ${error.message}`);
                
                if (error.message.includes('Invalid characters in request headers')) {
                    addAIResponse('üîß Issue: Browser header encoding problem');
                    addAIResponse('üí° Possible solutions:');
                    addAIResponse('   ‚Ä¢ This environment may need special Claude API setup');
                    addAIResponse('   ‚Ä¢ Try running in a different browser/environment');
                    addAIResponse('   ‚Ä¢ The API might need authentication headers');
                } else if (error.message.includes('400')) {
                    addAIResponse('üîß Issue: API request format problem');
                    addAIResponse('üí° The Claude API is reachable but rejecting our requests');
                } else {
                    addAIResponse('üîß Issue: Network or authentication problem');
                    addAIResponse('üí° Claude API endpoint may need specific configuration');
                }
                
                addAIResponse('üö´ STEPPPS requires real AI - no fallback enabled');
                addAIResponse('üìû You need genuine Claude API access for pixel intelligence');
                
                console.error('[STEPPPS] Full error details:', error);
            }
        }
        
        // LLM Query Functions
        async function queryClaude(prompt) {
            console.log('[STEPPPS] Querying Claude via FastAPI proxy...');

            try {
                const response = await fetch("/api/claude", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        api_key: llmConfig.apiKey,
                        request_data: {
                            model: llmConfig.model || "claude-3-sonnet-20240229",
                            max_tokens: 150,
                            messages: [{ role: "user", content: prompt }]
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.detail || response.statusText}`);
                }

                const data = await response.json();
                if (data.content && data.content[0] && data.content[0].text) {
                    console.log('[STEPPPS] Claude response received via FastAPI proxy');
                    return data.content[0].text;
                } else {
                    throw new Error('Unexpected response format');
                }
            } catch (error) {
                console.log('[STEPPPS] Claude error:', error);
                throw error;
            }
        }
        
        function createEnrichedPrompt(basePrompt, pixelContext) {
            if (!pixelContext) return basePrompt;
            
            return `STEPPPS PIXEL ANALYSIS

PIXEL CONTEXT:
‚Ä¢ Coordinates: (${pixelContext.x}, ${pixelContext.y})
‚Ä¢ Color: ${pixelContext.color}
‚Ä¢ Region: ${pixelContext.region}

CANVAS: ${canvas.width}x${canvas.height}
DEVICE: ${deviceId}

ANALYSIS REQUEST: ${basePrompt}

Provide a brief, insightful analysis (max 60 words).`;
        }
        
        // Canvas and Pixel Functions
        async function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor(event.clientX - rect.left);
            const y = Math.floor(event.clientY - rect.top);
            
            if (x >= 0 && x < canvas.width && y >= 0 && y < canvas.height) {
                console.log(`[STEPPPS] Canvas clicked at (${x}, ${y})`);
                await analyzePixelWithAI(x, y);
            }
        }
        
        async function analyzePixelWithAI(x, y) {
            const pixelKey = `${x},${y}`;
            
            let pixelData = pixelMatrix.get(pixelKey);
            if (!pixelData) {
                pixelData = createPixelSTEPPPS(x, y, 'manual_click');
            }
            
            if (!llmConfig.isConfigured) {
                addAIResponse(`‚ö†Ô∏è Pixel (${x}, ${y}) clicked but LLM not configured. Please test LLM first.`);
                return;
            }
            
            addAIResponse(`üîÑ Analyzing pixel (${x}, ${y}) with Claude...`);
            
            try {
                const originalColor = getPixelColor(x, y);
                const pixelContext = {
                    x: x,
                    y: y,
                    color: rgbToHex(originalColor.r, originalColor.g, originalColor.b),
                    region: getScreenRegion(x, y)
                };
                
                const prompt = "What does this pixel represent? Consider its color, position, and context.";
                const enrichedPrompt = createEnrichedPrompt(prompt, pixelContext);
                const aiResponse = await queryClaude(enrichedPrompt);
                
                // Update pixel data
                pixelData.prompt.ai_response = aiResponse;
                pixelData.prompt.history.push({
                    timestamp: new Date().toISOString(),
                    prompt: prompt,
                    response: aiResponse
                });
                
                pixelMatrix.set(pixelKey, pixelData);
                stats.aiAnalyzed++;
                
                // Display results
                addAIResponse(`üéØ Pixel (${x}, ${y}): ${aiResponse}`);
                showPixelData(pixelData);
                updateStats();
                
            } catch (error) {
                addAIResponse(`‚ùå AI analysis failed for pixel (${x}, ${y}): ${error.message}`);
            }
        }
        
        function createPixelSTEPPPS(x, y, eventType) {
            const pixelKey = `${x},${y}`;
            const timestamp = new Date().toISOString();
            const originalColor = getPixelColor(x, y);
            const enhancedColor = enhancePixelColor(originalColor, x, y);
            
            // Paint the enhanced pixel
            ctx.fillStyle = `rgb(${enhancedColor.r}, ${enhancedColor.g}, ${enhancedColor.b})`;
            ctx.fillRect(x, y, 1, 1);
            
            const stepppsData = {
                steppps_version: "2.0",
                pixel_coordinates: { x, y },
                device_id: deviceId,
                space: {
                    canvas_coordinates: { x, y },
                    region: getScreenRegion(x, y),
                    canvas_dimensions: { width: canvas.width, height: canvas.height }
                },
                time: {
                    created_at: timestamp,
                    updated_at: timestamp,
                    interaction_count: 1
                },
                event: {
                    type: eventType,
                    sequence: [eventType]
                },
                psychology: {
                    user_intent: 'analysis',
                    pixel_importance: calculatePixelImportance(x, y),
                    engagement_score: 0.8
                },
                pixel: {
                    original_color: originalColor,
                    enhanced_color: enhancedColor,
                    rgb_hex: rgbToHex(enhancedColor.r, enhancedColor.g, enhancedColor.b),
                    brightness: (enhancedColor.r + enhancedColor.g + enhancedColor.b) / 3
                },
                prompt: {
                    current: `Pixel at (${x}, ${y}) ready for AI analysis`,
                    ai_response: null,
                    history: [],
                    llm_provider: llmConfig.provider
                },
                script: {
                    local_hooks: [`enhancePixel(${x}, ${y})`],
                    ai_hooks: ['analyzeWithLLM']
                }
            };
            
            pixelMatrix.set(pixelKey, stepppsData);
            stats.intelligent++;
            return stepppsData;
        }
        
        // Helper Functions
        function getPixelColor(x, y) {
            const imageData = ctx.getImageData(x, y, 1, 1);
            const data = imageData.data;
            return { r: data[0], g: data[1], b: data[2], a: data[3] };
        }
        
        function enhancePixelColor(color, x, y) {
            const enhancement = 30 + Math.sin(x * 0.01) * 20 + Math.cos(y * 0.01) * 20;
            return {
                r: Math.min(255, Math.max(0, color.r + enhancement + (Math.random() - 0.5) * 40)),
                g: Math.min(255, Math.max(0, color.g + enhancement + (Math.random() - 0.5) * 40)),
                b: Math.min(255, Math.max(0, color.b + enhancement + (Math.random() - 0.5) * 40))
            };
        }
        
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        
        function getScreenRegion(x, y) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            if (x < centerX / 2) return y < centerY ? 'top-left' : 'bottom-left';
            if (x > centerX * 1.5) return y < centerY ? 'top-right' : 'bottom-right';
            return y < centerY ? 'top-center' : 'bottom-center';
        }
        
        function calculatePixelImportance(x, y) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const distance = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
            const maxDistance = Math.sqrt(centerX ** 2 + centerY ** 2);
            return 1 - (distance / maxDistance);
        }
        
        // UI Functions
        function addAIResponse(message) {
            const aiPanel = document.getElementById('aiResponses');
            const response = document.createElement('div');
            response.className = 'ai-response';
            response.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            aiPanel.insertBefore(response, aiPanel.firstChild);
            
            // Keep only last 10 responses
            while (aiPanel.children.length > 10) {
                aiPanel.removeChild(aiPanel.lastChild);
            }
        }
        
        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        function updateStats() {
            document.getElementById('intelligentCount').textContent = stats.intelligent;
            document.getElementById('aiAnalyzedCount').textContent = stats.aiAnalyzed;
        }
        
        function showPixelData(pixelData) {
            const dataPanel = document.getElementById('selectedPixelData');
            dataPanel.innerHTML = `
                <strong>Pixel (${pixelData.pixel_coordinates.x}, ${pixelData.pixel_coordinates.y})</strong><br>
                <strong>Color:</strong> ${pixelData.pixel.rgb_hex}<br>
                <strong>Region:</strong> ${pixelData.space.region}<br>
                <strong>Brightness:</strong> ${pixelData.pixel.brightness.toFixed(0)}<br>
                <strong>AI Response:</strong> ${pixelData.prompt.ai_response || 'Not analyzed yet'}<br>
                <strong>LLM Provider:</strong> ${pixelData.prompt.llm_provider}<br>
                <strong>Created:</strong> ${new Date(pixelData.time.created_at).toLocaleTimeString()}
            `;
        }
    </script>
</body>
</html>