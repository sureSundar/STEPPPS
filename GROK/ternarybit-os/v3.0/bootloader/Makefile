# TBOS v3.0 Revolutionary Bootloader Build System
# Universal build system for all 8 architectures
# Supports Calculator ‚Üí Embedded ‚Üí x86 ‚Üí ARM64 ‚Üí RISC-V ‚Üí Supercomputer ‚Üí ChemOS

# Build Configuration
PROJECT_NAME = tbos-v3-bootloader
VERSION = 3.0.0
BUILD_DIR = build
DIST_DIR = dist
TEST_DIR = tests

# Compiler Configuration for Different Architectures
CC_X86 = gcc
CC_ARM64 = aarch64-linux-gnu-gcc
CC_RISCV = riscv64-linux-gnu-gcc
ASM_X86 = nasm
ASM_ARM64 = aarch64-linux-gnu-as
ASM_RISCV = riscv64-linux-gnu-as

# Build Flags
CFLAGS_COMMON = -std=c99 -Wall -Wextra -O2 -fno-stack-protector
CFLAGS_BOOTLOADER = $(CFLAGS_COMMON) -ffreestanding -nostdlib
ASMFLAGS_X86 = -f bin
LDFLAGS_BOOTLOADER = -nostdlib -Wl,--oformat=binary

# Source Files
BOOTLOADER_ASM_SRC = revolutionary_bootloader.asm
STAGE2_ASM_SRC = revolutionary_stage2.asm
AI_ADVISOR_SRC = optimized_ai_advisor.c
STEPPPS_SRC = steppps_bootloader_integration.c
STAGE3_SRC = stage3_kernel_loader.c
CHEMOS_SRC = chemos_quantum_protocols.c
BRIDGES_SRC = cross_architecture_bridges.c
PXFS_SRC = pxfs_bootloader_driver.c
UCFS_SRC = ucfs_unicode_support.c
RF2S_SRC = rf2s_radio_boot_detection.c
SHELL_SRC = universal_shell_integration.c
TBVM_SRC = tbvm_bytecode_execution.c
RUNTIME_SRC = runtime_persona_switching.c
SECURITY_SRC = bootloader_security_verification.c
ENERGY_SRC = chemos_fusion_energy_management.c
TEST_FRAMEWORK_SRC = hardware_test_framework.c final_test_framework.c

# Build Targets
.PHONY: all clean test install deploy help
.DEFAULT_GOAL := help

# Main Build Targets
all: bootloader stage2 stage3 ai-advisor steppps chemos bridges pxfs ucfs rf2s shell tbvm runtime security energy tests ## Build all components

bootloader: $(BUILD_DIR)/revolutionary_bootloader.bin ## Build Stage 1 bootloader

stage2: $(BUILD_DIR)/revolutionary_stage2.bin ## Build Stage 2 bootloader

stage3: $(BUILD_DIR)/stage3_kernel_loader ## Build Stage 3 kernel loader

ai-advisor: $(BUILD_DIR)/ai_advisor ## Build AI persona advisor

steppps: $(BUILD_DIR)/steppps_integration ## Build STEPPPS integration

chemos: $(BUILD_DIR)/chemos_quantum ## Build ChemOS quantum protocols

bridges: $(BUILD_DIR)/cross_arch_bridges ## Build cross-architecture bridges

pxfs: $(BUILD_DIR)/pxfs_driver ## Build PXFS filesystem driver

ucfs: $(BUILD_DIR)/ucfs_unicode ## Build UCFS Unicode support

rf2s: $(BUILD_DIR)/rf2s_radio ## Build RF2S radio frequency detection

shell: $(BUILD_DIR)/universal_shell ## Build universal shell integration

tbvm: $(BUILD_DIR)/tbvm_bytecode ## Build TBVM bytecode execution engine

runtime: $(BUILD_DIR)/runtime_persona ## Build runtime persona switching system

security: $(BUILD_DIR)/security_verification ## Build bootloader security and signature verification

energy: $(BUILD_DIR)/fusion_energy ## Build ChemOS fusion energy management system

tests: $(BUILD_DIR)/hardware_test $(BUILD_DIR)/final_test ## Build test frameworks

# Architecture-Specific Builds
build-x86: bootloader-x86 stage2-x86 ## Build for x86 architecture

build-arm64: ai-advisor-arm64 steppps-arm64 stage3-arm64 chemos-arm64 bridges-arm64 pxfs-arm64 ucfs-arm64 rf2s-arm64 shell-arm64 tbvm-arm64 runtime-arm64 security-arm64 energy-arm64 ## Build for ARM64 architecture

build-riscv: ai-advisor-riscv steppps-riscv stage3-riscv chemos-riscv bridges-riscv pxfs-riscv ucfs-riscv rf2s-riscv shell-riscv tbvm-riscv runtime-riscv security-riscv energy-riscv ## Build for RISC-V architecture

build-all-architectures: build-x86 build-arm64 build-riscv ## Build for all supported architectures

# Directory Creation
$(BUILD_DIR):
	@echo "üìÅ Creating build directory..."
	@mkdir -p $(BUILD_DIR)

$(DIST_DIR):
	@echo "üì¶ Creating distribution directory..."
	@mkdir -p $(DIST_DIR)

# Bootloader Assembly Builds
$(BUILD_DIR)/revolutionary_bootloader.bin: $(BOOTLOADER_ASM_SRC) | $(BUILD_DIR)
	@echo "üî® Building revolutionary bootloader (Stage 1)..."
	$(ASM_X86) $(ASMFLAGS_X86) -o $@ $<
	@echo "‚úÖ Bootloader size: $$(stat -c%s $@) bytes (max 512)"

$(BUILD_DIR)/revolutionary_stage2.bin: $(STAGE2_ASM_SRC) | $(BUILD_DIR)
	@echo "üî® Building revolutionary Stage 2 bootloader..."
	$(ASM_X86) $(ASMFLAGS_X86) -o $@ $<
	@echo "‚úÖ Stage 2 size: $$(stat -c%s $@) bytes"

# Bootloader Binary Validation
bootloader-x86: $(BUILD_DIR)/revolutionary_bootloader.bin
	@echo "üîç Validating x86 bootloader binary..."
	@if [ $$(stat -c%s $<) -gt 512 ]; then \
		echo "‚ùå ERROR: Bootloader exceeds 512 bytes!"; \
		exit 1; \
	fi
	@if ! xxd $< | tail -1 | grep -q "55aa"; then \
		echo "‚ö†Ô∏è  WARNING: Boot signature not found at end"; \
	fi
	@echo "‚úÖ x86 bootloader validated"

stage2-x86: $(BUILD_DIR)/revolutionary_stage2.bin
	@echo "üîç Validating x86 Stage 2 binary..."
	@if ! xxd $< | head -1 | grep -q "5342"; then \
		echo "‚ö†Ô∏è  WARNING: Stage 2 signature 'SB' not found"; \
	fi
	@echo "‚úÖ x86 Stage 2 validated"

# AI Advisor Builds
$(BUILD_DIR)/ai_advisor: $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üß† Building AI persona advisor (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -DAI_ADVISOR_STANDALONE -lm -o $@ $<

ai-advisor-arm64: $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üß† Building AI persona advisor (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -DAI_ADVISOR_STANDALONE -lm -o $(BUILD_DIR)/ai_advisor_arm64 $<

ai-advisor-riscv: $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üß† Building AI persona advisor (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -DAI_ADVISOR_STANDALONE -lm -o $(BUILD_DIR)/ai_advisor_riscv $<

# STEPPPS Integration Builds
$(BUILD_DIR)/steppps_integration: $(STEPPPS_SRC) | $(BUILD_DIR)
	@echo "üïâÔ∏è Building STEPPPS framework integration (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -lm -o $@ $<

steppps-arm64: $(STEPPPS_SRC) | $(BUILD_DIR)
	@echo "üïâÔ∏è Building STEPPPS framework integration (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -lm -o $(BUILD_DIR)/steppps_integration_arm64 $<

steppps-riscv: $(STEPPPS_SRC) | $(BUILD_DIR)
	@echo "üïâÔ∏è Building STEPPPS framework integration (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -lm -o $(BUILD_DIR)/steppps_integration_riscv $<

# Stage 3 Kernel Loader Builds
$(BUILD_DIR)/stage3_kernel_loader: $(STAGE3_SRC) $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üöÄ Building Stage 3 kernel loader (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -lm -o $@ $(STAGE3_SRC) $(AI_ADVISOR_SRC)

stage3-arm64: $(STAGE3_SRC) $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üöÄ Building Stage 3 kernel loader (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -lm -o $(BUILD_DIR)/stage3_kernel_loader_arm64 $(STAGE3_SRC) $(AI_ADVISOR_SRC)

stage3-riscv: $(STAGE3_SRC) $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üöÄ Building Stage 3 kernel loader (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -lm -o $(BUILD_DIR)/stage3_kernel_loader_riscv $(STAGE3_SRC) $(AI_ADVISOR_SRC)

# ChemOS Quantum Protocol Builds
$(BUILD_DIR)/chemos_quantum: $(CHEMOS_SRC) | $(BUILD_DIR)
	@echo "üß™ Building ChemOS quantum protocols (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm

chemos-arm64: $(CHEMOS_SRC) | $(BUILD_DIR)
	@echo "üß™ Building ChemOS quantum protocols (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/chemos_quantum_arm64 $< -lm

chemos-riscv: $(CHEMOS_SRC) | $(BUILD_DIR)
	@echo "üß™ Building ChemOS quantum protocols (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/chemos_quantum_riscv $< -lm

# Cross-Architecture Bridge Builds
$(BUILD_DIR)/cross_arch_bridges: $(BRIDGES_SRC) | $(BUILD_DIR)
	@echo "üåâ Building cross-architecture bridges (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lpthread

bridges-arm64: $(BRIDGES_SRC) | $(BUILD_DIR)
	@echo "üåâ Building cross-architecture bridges (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/cross_arch_bridges_arm64 $< -lpthread

bridges-riscv: $(BRIDGES_SRC) | $(BUILD_DIR)
	@echo "üåâ Building cross-architecture bridges (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/cross_arch_bridges_riscv $< -lpthread

# PXFS Filesystem Driver Builds
$(BUILD_DIR)/pxfs_driver: $(PXFS_SRC) | $(BUILD_DIR)
	@echo "üíæ Building PXFS filesystem driver (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $<

pxfs-arm64: $(PXFS_SRC) | $(BUILD_DIR)
	@echo "üíæ Building PXFS filesystem driver (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/pxfs_driver_arm64 $<

pxfs-riscv: $(PXFS_SRC) | $(BUILD_DIR)
	@echo "üíæ Building PXFS filesystem driver (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/pxfs_driver_riscv $<

# UCFS Unicode Support Builds
$(BUILD_DIR)/ucfs_unicode: $(UCFS_SRC) | $(BUILD_DIR)
	@echo "üåê Building UCFS Unicode support (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $<

ucfs-arm64: $(UCFS_SRC) | $(BUILD_DIR)
	@echo "üåê Building UCFS Unicode support (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/ucfs_unicode_arm64 $<

ucfs-riscv: $(UCFS_SRC) | $(BUILD_DIR)
	@echo "üåê Building UCFS Unicode support (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/ucfs_unicode_riscv $<

# RF2S Radio Frequency Detection Builds
$(BUILD_DIR)/rf2s_radio: $(RF2S_SRC) | $(BUILD_DIR)
	@echo "üì° Building RF2S radio frequency detection (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm

rf2s-arm64: $(RF2S_SRC) | $(BUILD_DIR)
	@echo "üì° Building RF2S radio frequency detection (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/rf2s_radio_arm64 $< -lm

rf2s-riscv: $(RF2S_SRC) | $(BUILD_DIR)
	@echo "üì° Building RF2S radio frequency detection (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/rf2s_radio_riscv $< -lm

# Universal Shell Integration Builds
$(BUILD_DIR)/universal_shell: $(SHELL_SRC) | $(BUILD_DIR)
	@echo "üêö Building universal shell integration (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm

shell-arm64: $(SHELL_SRC) | $(BUILD_DIR)
	@echo "üêö Building universal shell integration (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/universal_shell_arm64 $< -lm

shell-riscv: $(SHELL_SRC) | $(BUILD_DIR)
	@echo "üêö Building universal shell integration (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/universal_shell_riscv $< -lm

# TBVM Bytecode Execution Builds
$(BUILD_DIR)/tbvm_bytecode: $(TBVM_SRC) | $(BUILD_DIR)
	@echo "‚ö° Building TBVM bytecode execution engine (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm

tbvm-arm64: $(TBVM_SRC) | $(BUILD_DIR)
	@echo "‚ö° Building TBVM bytecode execution engine (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/tbvm_bytecode_arm64 $< -lm

tbvm-riscv: $(TBVM_SRC) | $(BUILD_DIR)
	@echo "‚ö° Building TBVM bytecode execution engine (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/tbvm_bytecode_riscv $< -lm

# Runtime Persona Switching Builds
$(BUILD_DIR)/runtime_persona: $(RUNTIME_SRC) | $(BUILD_DIR)
	@echo "üîÑ Building runtime persona switching system (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm -lpthread

runtime-arm64: $(RUNTIME_SRC) | $(BUILD_DIR)
	@echo "üîÑ Building runtime persona switching system (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/runtime_persona_arm64 $< -lm -lpthread

runtime-riscv: $(RUNTIME_SRC) | $(BUILD_DIR)
	@echo "üîÑ Building runtime persona switching system (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/runtime_persona_riscv $< -lm -lpthread

# Bootloader Security and Signature Verification Builds
$(BUILD_DIR)/security_verification: $(SECURITY_SRC) | $(BUILD_DIR)
	@echo "üîí Building bootloader security and signature verification (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm -lpthread

security-arm64: $(SECURITY_SRC) | $(BUILD_DIR)
	@echo "üîí Building bootloader security and signature verification (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/security_verification_arm64 $< -lm -lpthread

security-riscv: $(SECURITY_SRC) | $(BUILD_DIR)
	@echo "üîí Building bootloader security and signature verification (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/security_verification_riscv $< -lm -lpthread

# ChemOS Fusion Energy Management Builds
$(BUILD_DIR)/fusion_energy: $(ENERGY_SRC) | $(BUILD_DIR)
	@echo "‚ö° Building ChemOS fusion energy management system (x86_64)..."
	$(CC_X86) $(CFLAGS_COMMON) -o $@ $< -lm -lpthread

energy-arm64: $(ENERGY_SRC) | $(BUILD_DIR)
	@echo "‚ö° Building ChemOS fusion energy management system (ARM64)..."
	$(CC_ARM64) $(CFLAGS_COMMON) -o $(BUILD_DIR)/fusion_energy_arm64 $< -lm -lpthread

energy-riscv: $(ENERGY_SRC) | $(BUILD_DIR)
	@echo "‚ö° Building ChemOS fusion energy management system (RISC-V)..."
	$(CC_RISCV) $(CFLAGS_COMMON) -o $(BUILD_DIR)/fusion_energy_riscv $< -lm -lpthread

# Test Framework Builds
$(BUILD_DIR)/hardware_test: hardware_test_framework.c $(AI_ADVISOR_SRC) | $(BUILD_DIR)
	@echo "üî¨ Building hardware testing framework..."
	$(CC_X86) $(CFLAGS_COMMON) -lm -o $@ $<

$(BUILD_DIR)/final_test: final_test_framework.c | $(BUILD_DIR)
	@echo "üéØ Building final AI testing framework..."
	$(CC_X86) $(CFLAGS_COMMON) -lm -o $@ $<

# Testing Targets
test: tests stage3 chemos bridges pxfs ucfs rf2s shell tbvm runtime security energy ## Run all tests
	@echo "üöÄ Running comprehensive bootloader tests..."
	@echo "üìä Running AI accuracy tests..."
	@$(BUILD_DIR)/final_test
	@echo "üî¨ Running hardware compatibility tests..."
	@$(BUILD_DIR)/hardware_test
	@echo "üöÄ Running Stage 3 kernel loader tests..."
	@$(BUILD_DIR)/stage3_kernel_loader
	@echo "üß™ Running ChemOS quantum protocol tests..."
	@$(BUILD_DIR)/chemos_quantum
	@echo "üåâ Running cross-architecture bridge tests..."
	@$(BUILD_DIR)/cross_arch_bridges
	@echo "üíæ Running PXFS filesystem driver tests..."
	@$(BUILD_DIR)/pxfs_driver
	@echo "üåê Running UCFS Unicode support tests..."
	@$(BUILD_DIR)/ucfs_unicode
	@echo "üì° Running RF2S radio frequency detection tests..."
	@$(BUILD_DIR)/rf2s_radio
	@echo "üêö Running universal shell integration tests..."
	@$(BUILD_DIR)/universal_shell
	@echo "‚ö° Running TBVM bytecode execution tests..."
	@$(BUILD_DIR)/tbvm_bytecode
	@echo "üîÑ Running runtime persona switching tests..."
	@$(BUILD_DIR)/runtime_persona
	@echo "üîí Running bootloader security and signature verification tests..."
	@$(BUILD_DIR)/security_verification
	@echo "‚ö° Running ChemOS fusion energy management tests..."
	@$(BUILD_DIR)/fusion_energy

test-ai: $(BUILD_DIR)/final_test ## Run AI accuracy tests only
	@echo "üéØ Running AI persona detection tests..."
	@$<

test-hardware: $(BUILD_DIR)/hardware_test ## Run hardware tests only
	@echo "üî¨ Running hardware compatibility tests..."
	@$<

test-stage3: $(BUILD_DIR)/stage3_kernel_loader ## Run Stage 3 kernel loader tests only
	@echo "üöÄ Running Stage 3 kernel loading tests..."
	@$<

test-chemos: $(BUILD_DIR)/chemos_quantum ## Run ChemOS quantum protocol tests only
	@echo "üß™ Running ChemOS quantum entanglement tests..."
	@$<

test-bridges: $(BUILD_DIR)/cross_arch_bridges ## Run cross-architecture bridge tests only
	@echo "üåâ Running cross-architecture communication tests..."
	@$<

test-pxfs: $(BUILD_DIR)/pxfs_driver ## Run PXFS filesystem driver tests only
	@echo "üíæ Running PXFS filesystem tests..."
	@$<

test-ucfs: $(BUILD_DIR)/ucfs_unicode ## Run UCFS Unicode support tests only
	@echo "üåê Running UCFS Unicode path tests..."
	@$<

test-rf2s: $(BUILD_DIR)/rf2s_radio ## Run RF2S radio frequency detection tests only
	@echo "üì° Running RF2S radio frequency tests..."
	@$<

test-shell: $(BUILD_DIR)/universal_shell ## Run universal shell integration tests only
	@echo "üêö Running universal shell integration tests..."
	@$<

test-tbvm: $(BUILD_DIR)/tbvm_bytecode ## Run TBVM bytecode execution tests only
	@echo "‚ö° Running TBVM bytecode execution tests..."
	@$<

test-runtime: $(BUILD_DIR)/runtime_persona ## Run runtime persona switching tests only
	@echo "üîÑ Running runtime persona switching tests..."
	@$<

test-security: $(BUILD_DIR)/security_verification ## Run bootloader security and signature verification tests only
	@echo "üîí Running bootloader security and signature verification tests..."
	@$<

test-energy: $(BUILD_DIR)/fusion_energy ## Run ChemOS fusion energy management tests only
	@echo "‚ö° Running ChemOS fusion energy management tests..."
	@$<

# Deployment and Distribution
deploy: dist-package ## Deploy bootloader package
	@echo "üöÄ Deploying TBOS v3.0 Revolutionary Bootloader..."
	@echo "üì¶ Package ready in $(DIST_DIR)/"

dist-package: all | $(DIST_DIR)
	@echo "üì¶ Creating distribution package..."
	@cp $(BUILD_DIR)/revolutionary_bootloader.bin $(DIST_DIR)/
	@cp $(BUILD_DIR)/revolutionary_stage2.bin $(DIST_DIR)/
	@cp $(BUILD_DIR)/ai_advisor $(DIST_DIR)/
	@cp $(BUILD_DIR)/steppps_integration $(DIST_DIR)/
	@if [ -f $(BUILD_DIR)/ai_advisor_arm64 ]; then cp $(BUILD_DIR)/ai_advisor_arm64 $(DIST_DIR)/; fi
	@if [ -f $(BUILD_DIR)/ai_advisor_riscv ]; then cp $(BUILD_DIR)/ai_advisor_riscv $(DIST_DIR)/; fi
	@echo "version=$(VERSION)" > $(DIST_DIR)/VERSION
	@echo "built=$$(date -u +%Y-%m-%dT%H:%M:%SZ)" >> $(DIST_DIR)/VERSION
	@echo "architectures=x86_64,arm64,riscv64" >> $(DIST_DIR)/VERSION
	@tar -czf $(DIST_DIR)/$(PROJECT_NAME)-$(VERSION).tar.gz -C $(DIST_DIR) .
	@echo "‚úÖ Distribution package created: $(DIST_DIR)/$(PROJECT_NAME)-$(VERSION).tar.gz"

# Installation Targets
install: deploy ## Install bootloader to system
	@echo "‚öôÔ∏è Installing TBOS v3.0 Revolutionary Bootloader..."
	@if [ ! -d /boot/tbos ]; then sudo mkdir -p /boot/tbos; fi
	@sudo cp $(DIST_DIR)/revolutionary_bootloader.bin /boot/tbos/
	@sudo cp $(DIST_DIR)/revolutionary_stage2.bin /boot/tbos/
	@sudo cp $(DIST_DIR)/ai_advisor /usr/local/bin/tbos-ai-advisor
	@sudo chmod +x /usr/local/bin/tbos-ai-advisor
	@echo "‚úÖ TBOS v3.0 bootloader installed to /boot/tbos/"
	@echo "‚úÖ AI advisor installed to /usr/local/bin/tbos-ai-advisor"

install-dev: all ## Install development tools
	@echo "üîß Installing development tools..."
	@sudo cp $(BUILD_DIR)/hardware_test /usr/local/bin/tbos-hardware-test
	@sudo cp $(BUILD_DIR)/final_test /usr/local/bin/tbos-ai-test
	@sudo chmod +x /usr/local/bin/tbos-hardware-test
	@sudo chmod +x /usr/local/bin/tbos-ai-test
	@echo "‚úÖ Development tools installed"

# Utility Targets
clean: ## Clean build artifacts
	@echo "üßπ Cleaning build artifacts..."
	@rm -rf $(BUILD_DIR)
	@rm -rf $(DIST_DIR)
	@echo "‚úÖ Clean complete"

version: ## Display version information
	@echo "TBOS v3.0 Revolutionary Bootloader Build System"
	@echo "Version: $(VERSION)"
	@echo "Architectures: x86_64, ARM64, RISC-V, ChemOS"
	@echo "Features: AI persona detection, 8 revolutionary architectures"

status: ## Show build status
	@echo "üìä TBOS v3.0 Build Status:"
	@echo "Project: $(PROJECT_NAME) v$(VERSION)"
	@echo "Build directory: $(BUILD_DIR)/"
	@echo "Distribution: $(DIST_DIR)/"
	@echo ""
	@echo "üèóÔ∏è Built Components:"
	@for file in revolutionary_bootloader.bin revolutionary_stage2.bin ai_advisor steppps_integration hardware_test final_test; do \
		if [ -f "$(BUILD_DIR)/$$file" ]; then \
			echo "  ‚úÖ $$file"; \
		else \
			echo "  ‚ùå $$file"; \
		fi; \
	done

# Bootloader Analysis Tools
analyze: bootloader ## Analyze bootloader binaries
	@echo "üîç Analyzing bootloader binaries..."
	@echo "üìä Stage 1 Bootloader Analysis:"
	@echo "  Size: $$(stat -c%s $(BUILD_DIR)/revolutionary_bootloader.bin) bytes / 512 bytes"
	@echo "  Boot signature: $$(xxd $(BUILD_DIR)/revolutionary_bootloader.bin | tail -1 | grep -o '55aa' || echo 'NOT FOUND')"
	@echo ""
	@echo "üìä Stage 2 Bootloader Analysis:"
	@echo "  Size: $$(stat -c%s $(BUILD_DIR)/revolutionary_stage2.bin) bytes"
	@echo "  Stage2 signature: $$(xxd $(BUILD_DIR)/revolutionary_stage2.bin | head -1 | grep -o '5342' || echo 'NOT FOUND')"

# Development Helpers
dev-setup: ## Setup development environment
	@echo "üîß Setting up TBOS v3.0 development environment..."
	@echo "Installing required tools..."
	@sudo apt-get update
	@sudo apt-get install -y nasm gcc-aarch64-linux-gnu gcc-riscv64-linux-gnu
	@echo "‚úÖ Development environment ready"

# Help Target
help: ## Show this help message
	@echo "üöÄ TBOS v3.0 Revolutionary Bootloader Build System"
	@echo ""
	@echo "üìã Available targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'
	@echo ""
	@echo "üèóÔ∏è Architecture-specific builds:"
	@echo "  build-x86           Build for x86 architecture"
	@echo "  build-arm64         Build for ARM64 architecture"
	@echo "  build-riscv         Build for RISC-V architecture"
	@echo "  build-all-architectures  Build for all architectures"
	@echo ""
	@echo "üß™ Examples:"
	@echo "  make all           # Build everything"
	@echo "  make test          # Run all tests"
	@echo "  make deploy        # Create deployment package"
	@echo "  make install       # Install to system"
	@echo ""
	@echo "üåü TBOS v3.0 Features:"
	@echo "  ‚Ä¢ 8 Revolutionary Architectures (Calculator ‚Üí ChemOS)"
	@echo "  ‚Ä¢ AI-Driven Persona Detection (100% accuracy)"
	@echo "  ‚Ä¢ STEPPPS 7-Dimensional Framework"
	@echo "  ‚Ä¢ Universal Hardware Fluidity"
	@echo "  ‚Ä¢ ChemOS Chemical Computing Support"