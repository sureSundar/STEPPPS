<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEPPPS Canvas Platform</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            color: #ecf0f1;
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #3498db;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #bdc3c7;
            margin-bottom: 30px;
            font-size: 18px;
        }

        #steppps-canvas {
            border: 3px solid #3498db;
            background: #ecf0f1;
            display: block;
            margin: 0 auto;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }

        .controls {
            margin-top: 30px;
            text-align: center;
        }

        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .info-panel {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            border-radius: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            border: 1px solid #3498db;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            color: #3498db;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            color: #2ecc71;
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
        }

        .logs {
            margin-top: 20px;
            background: #1a252f;
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #34495e;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #34495e;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-event { color: #3498db; }
        .log-click { color: #2ecc71; }
        .log-bootstrap { color: #f39c12; }
        .log-error { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ STEPPPS Self-Bootstrapping Canvas Platform</h1>
        <p class="subtitle">Every canvas element IS a STEPPPS object - Click to interact!</p>

        <canvas id="steppps-canvas" width="1200" height="700"></canvas>

        <div class="controls">
            <button onclick="bootstrapPlatform()">üîÑ Bootstrap Platform</button>
            <button onclick="createPixel()">üéØ Create Pixel</button>
            <button onclick="morphShapes()">üîÆ Morph Shapes</button>
            <button onclick="animateObjects()">‚ú® Animate</button>
            <button onclick="exportJSON()">üìÑ Export JSON</button>
            <button onclick="clearCanvas()">üóëÔ∏è Clear Canvas</button>
        </div>

        <div class="info-panel">
            <div class="info-item">
                <div class="info-label">Platform Status</div>
                <div class="info-value" id="platform-status">Initializing...</div>
            </div>
            <div class="info-item">
                <div class="info-label">STEPPPS Objects</div>
                <div class="info-value" id="object-count">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">Frame Count</div>
                <div class="info-value" id="frame-count">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">Last Event</div>
                <div class="info-value" id="last-event">None</div>
            </div>
        </div>

        <div class="logs" id="logs">
            <div class="log-entry log-event">üéØ STEPPPS Canvas Platform Initialized</div>
        </div>
    </div>

    <script>
        // STEPPPS Canvas Platform - Self-bootstrapping implementation
        class STEPPPSObject {
            constructor(id, type, x = 0, y = 0, width = 20, height = 20) {
                this.id = id;
                this.type = type;
                this.data = {
                    space: { x, y, width, height },
                    temporal: { timestamp: Date.now(), frame: 0 },
                    event: { lastEvent: 'created', interactive: true },
                    psychology: { emotion: 'neutral', energy: Math.random() },
                    pixel: {
                        color: this.generateColor(),
                        alpha: 0.8 + Math.random() * 0.2
                    },
                    prompt: { text: `${type} object` },
                    script: { animation: null, behavior: 'responsive' }
                };
                this.children = [];
                this.visible = true;
                this.dirty = true;
            }

            generateColor() {
                const colors = [
                    '#e74c3c', '#3498db', '#2ecc71', '#f39c12',
                    '#9b59b6', '#1abc9c', '#34495e', '#e67e22'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            bootstrap(source = 'genesis') {
                this.data.event.lastEvent = `bootstrapped_from_${source}`;
                this.data.temporal.timestamp = Date.now();

                // Simulate LLM enhancement
                if (source === 'llm') {
                    this.data.psychology.emotion = 'enhanced';
                    this.data.pixel.color = this.generateColor();
                }

                this.dirty = true;
                return true;
            }

            contains(x, y) {
                const s = this.data.space;
                return x >= s.x && x <= s.x + s.width &&
                       y >= s.y && y <= s.y + s.height;
            }

            onClick(x, y) {
                this.data.event.lastEvent = 'clicked';
                this.data.temporal.timestamp = Date.now();
                this.data.psychology.energy = Math.min(1, this.data.psychology.energy + 0.2);

                // Cycle colors on click
                this.data.pixel.color = this.generateColor();

                // Morph slightly
                this.data.space.width = Math.max(15, Math.min(50, this.data.space.width + (Math.random() - 0.5) * 10));
                this.data.space.height = Math.max(15, Math.min(50, this.data.space.height + (Math.random() - 0.5) * 10));

                this.dirty = true;

                logEvent(`üéØ Clicked ${this.type} ${this.id} - color: ${this.data.pixel.color}`, 'click');
                return true;
            }

            render(ctx) {
                if (!this.visible) return;

                const s = this.data.space;
                const p = this.data.pixel;

                ctx.save();
                ctx.globalAlpha = p.alpha;

                // Draw based on type
                switch (this.type) {
                    case 'pixel':
                        ctx.fillStyle = p.color;
                        ctx.fillRect(s.x, s.y, s.width, s.height);
                        ctx.strokeStyle = '#2c3e50';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(s.x, s.y, s.width, s.height);
                        break;

                    case 'circle':
                        ctx.beginPath();
                        ctx.arc(s.x + s.width/2, s.y + s.height/2, Math.min(s.width, s.height)/2, 0, 2 * Math.PI);
                        ctx.fillStyle = p.color;
                        ctx.fill();
                        ctx.strokeStyle = '#2c3e50';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        break;

                    case 'button':
                        // Rounded rectangle
                        const radius = 5;
                        ctx.beginPath();
                        ctx.roundRect(s.x, s.y, s.width, s.height, radius);
                        ctx.fillStyle = p.color;
                        ctx.fill();
                        ctx.strokeStyle = '#2c3e50';
                        ctx.lineWidth = 2;
                        ctx.stroke();

                        // Button text
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '12px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('STEPPPS', s.x + s.width/2, s.y + s.height/2 + 4);
                        break;
                }

                ctx.restore();
                this.dirty = false;
            }

            toJSON() {
                return {
                    id: this.id,
                    type: this.type,
                    data: this.data,
                    children: this.children.length
                };
            }
        }

        class STEPPPSCanvasPlatform {
            constructor() {
                this.canvas = document.getElementById('steppps-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.objects = [];
                this.frameCount = 0;
                this.animating = false;

                this.canvas.addEventListener('click', (e) => this.handleClick(e));
                this.bootstrap();
                this.startRenderLoop();

                logEvent('üöÄ STEPPPS Canvas Platform Bootstrapped', 'bootstrap');
            }

            bootstrap() {
                logEvent('üîÑ Bootstrapping platform...', 'bootstrap');

                // Create initial STEPPPS objects
                this.createInitialObjects();

                // Update UI
                document.getElementById('platform-status').textContent = 'Active';
                this.updateObjectCount();

                logEvent('‚úÖ Platform bootstrap complete', 'bootstrap');
            }

            createInitialObjects() {
                // Create pixel grid
                for (let row = 0; row < 6; row++) {
                    for (let col = 0; col < 10; col++) {
                        const x = 100 + col * 60;
                        const y = 100 + row * 80;
                        const pixel = new STEPPPSObject(`pixel_${row}_${col}`, 'pixel', x, y, 40, 40);
                        pixel.bootstrap('llm');
                        this.objects.push(pixel);
                    }
                }

                // Create some special objects
                const button = new STEPPPSObject('demo_button', 'button', 800, 150, 100, 40);
                button.bootstrap('llm');
                this.objects.push(button);

                const circle = new STEPPPSObject('demo_circle', 'circle', 950, 200, 80, 80);
                circle.bootstrap('llm');
                this.objects.push(circle);

                // Create interactive shapes
                for (let i = 0; i < 5; i++) {
                    const shape = new STEPPPSObject(`shape_${i}`, 'circle',
                        800 + i * 70, 350, 50, 50);
                    shape.bootstrap('llm');
                    this.objects.push(shape);
                }
            }

            handleClick(event) {
                const rect = this.canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                // Find clicked object (reverse order for top-most)
                for (let i = this.objects.length - 1; i >= 0; i--) {
                    const obj = this.objects[i];
                    if (obj.contains(x, y)) {
                        obj.onClick(x, y);
                        document.getElementById('last-event').textContent = `Clicked ${obj.id}`;
                        this.render();
                        return;
                    }
                }

                // Create new pixel at click location
                this.createPixelAt(x, y);
            }

            createPixelAt(x, y) {
                const id = `dynamic_${Date.now()}`;
                const pixel = new STEPPPSObject(id, 'pixel', x - 10, y - 10, 20, 20);
                pixel.bootstrap('llm');
                this.objects.push(pixel);
                this.updateObjectCount();

                logEvent(`‚ûï Created pixel at (${x}, ${y})`, 'click');
                this.render();
            }

            render() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                // Render background
                this.ctx.fillStyle = '#ecf0f1';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Render all objects
                this.objects.forEach(obj => obj.render(this.ctx));

                // Update frame count
                this.frameCount++;
                document.getElementById('frame-count').textContent = this.frameCount;
            }

            startRenderLoop() {
                const loop = () => {
                    if (this.animating || this.objects.some(obj => obj.dirty)) {
                        this.render();
                    }
                    requestAnimationFrame(loop);
                };
                loop();
            }

            updateObjectCount() {
                document.getElementById('object-count').textContent = this.objects.length;
            }

            morphShapes() {
                this.objects.forEach(obj => {
                    if (obj.type === 'circle') {
                        obj.type = 'pixel';
                    } else if (obj.type === 'pixel' && Math.random() > 0.7) {
                        obj.type = 'circle';
                    }
                    obj.dirty = true;
                });

                logEvent('üîÆ Morphed shapes', 'event');
                this.render();
            }

            animate() {
                this.animating = !this.animating;

                if (this.animating) {
                    const animateFrame = () => {
                        if (!this.animating) return;

                        this.objects.forEach(obj => {
                            // Gentle movement
                            obj.data.space.x += (Math.random() - 0.5) * 2;
                            obj.data.space.y += (Math.random() - 0.5) * 2;

                            // Keep in bounds
                            obj.data.space.x = Math.max(0, Math.min(this.canvas.width - obj.data.space.width, obj.data.space.x));
                            obj.data.space.y = Math.max(0, Math.min(this.canvas.height - obj.data.space.height, obj.data.space.y));

                            obj.dirty = true;
                        });

                        setTimeout(animateFrame, 50);
                    };
                    animateFrame();
                    logEvent('‚ú® Animation started', 'event');
                } else {
                    logEvent('‚è∏Ô∏è Animation stopped', 'event');
                }
            }

            exportToJSON() {
                const platformData = {
                    platform: {
                        id: 'steppps_canvas_platform',
                        timestamp: Date.now(),
                        frame: this.frameCount,
                        objects: this.objects.length
                    },
                    objects: this.objects.map(obj => obj.toJSON())
                };

                console.log('STEPPPS Platform JSON:', platformData);

                // Copy to clipboard if possible
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(JSON.stringify(platformData, null, 2))
                        .then(() => logEvent('üìã JSON copied to clipboard', 'event'))
                        .catch(() => logEvent('üìÑ JSON logged to console', 'event'));
                } else {
                    logEvent('üìÑ JSON logged to console (F12)', 'event');
                }

                return platformData;
            }

            clear() {
                this.objects = [];
                this.updateObjectCount();
                this.render();
                logEvent('üóëÔ∏è Canvas cleared', 'event');
            }
        }

        // Utility functions
        function logEvent(message, type = 'event') {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;

            // Keep only last 50 entries
            while (logs.children.length > 50) {
                logs.removeChild(logs.firstChild);
            }
        }

        // Global functions for buttons
        function bootstrapPlatform() {
            platform.bootstrap();
        }

        function createPixel() {
            const x = Math.random() * (platform.canvas.width - 50) + 25;
            const y = Math.random() * (platform.canvas.height - 50) + 25;
            platform.createPixelAt(x, y);
        }

        function morphShapes() {
            platform.morphShapes();
        }

        function animateObjects() {
            platform.animate();
        }

        function exportJSON() {
            platform.exportToJSON();
        }

        function clearCanvas() {
            platform.clear();
        }

        // Initialize platform
        let platform;
        window.addEventListener('load', () => {
            platform = new STEPPPSCanvasPlatform();
        });
    </script>
</body>
</html>