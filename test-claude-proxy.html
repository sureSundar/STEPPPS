<!DOCTYPE html>
<html>
<head>
    <title>Claude API Proxy Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Claude API Proxy Test</h1>
        <p>This tests Claude API through our proxy server (no CORS issues).</p>

        <div>
            <label>Claude API Key:</label>
            <input type="password" id="apiKey" placeholder="sk-ant-..." />
        </div>

        <div>
            <button onclick="testProxy()">Test Proxy Connection</button>
            <button onclick="testSTEPPPS()">Test STEPPPS Pixel Intelligence</button>
        </div>

        <div id="result"></div>
    </div>

    <script>
        function showResult(content, type = 'success') {
            const result = document.getElementById('result');
            result.className = `result ${type}`;
            result.textContent = content;
        }

        async function testProxy() {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                showResult('Please enter your Claude API key', 'error');
                return;
            }

            showResult('Testing proxy connection to Claude...', 'loading');

            try {
                const response = await fetch('/api/claude', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        requestData: {
                            model: 'claude-3-sonnet-20240229',
                            max_tokens: 50,
                            messages: [{
                                role: 'user',
                                content: 'Say "Hello STEPPPS Protocol!" and nothing else.'
                            }]
                        }
                    })
                });

                console.log('Proxy response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('Proxy error response:', errorText);

                    let errorMessage;
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorData.message || 'Unknown error';
                    } catch {
                        errorMessage = errorText || response.statusText;
                    }

                    showResult(`Proxy Error (${response.status}): ${errorMessage}`, 'error');
                    return;
                }

                const data = await response.json();
                console.log('Proxy success:', data);

                showResult(`âœ… PROXY SUCCESS!\n\nClaude said: "${data.content[0].text}"\n\nThe proxy is working! CORS issue solved!`, 'success');

            } catch (error) {
                console.error('Proxy network error:', error);
                showResult(`Proxy Network Error: ${error.message}\n\nCheck if the proxy server is running on localhost:3001`, 'error');
            }
        }

        async function testSTEPPPS() {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                showResult('Please enter your Claude API key', 'error');
                return;
            }

            showResult('Testing STEPPPS pixel intelligence via proxy...', 'loading');

            const stepppsPrompt = `STEPPPS PIXEL ANALYSIS REQUEST:

PIXEL CONTEXT:
- Coordinates: (245, 167)
- Canvas Region: center
- Color: rgba(78, 205, 196, 1) - vibrant cyan
- Luminance: 65.2%
- Saturation: 87.4%
- Canvas Size: 400x300

USER CONTEXT:
- Intent: exploration of pixel intelligence
- Engagement: 0.8 (highly engaged)
- Emotional State: curious and excited
- Interaction Count: 1

ANALYSIS REQUEST:
You are an intelligent pixel in the revolutionary STEPPPS protocol. Each pixel contains 8 dimensions of intelligence: Space, Time, Event, Psychology, Pixel properties, Prompt history, and Script behaviors.

Analyze your role as this specific cyan pixel in the center of the canvas. What do you represent in this visual composition? How do you contribute to the user's exploration experience? Respond as the pixel itself in 2-3 creative sentences.`;

            try {
                const response = await fetch('/api/claude', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        requestData: {
                            model: 'claude-3-sonnet-20240229',
                            max_tokens: 200,
                            messages: [{
                                role: 'user',
                                content: stepppsPrompt
                            }]
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage;
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorData.message || 'Unknown error';
                    } catch {
                        errorMessage = errorText || response.statusText;
                    }
                    showResult(`STEPPPS Test Error: ${errorMessage}`, 'error');
                    return;
                }

                const data = await response.json();

                showResult(`ðŸš€ STEPPPS PIXEL INTELLIGENCE SUCCESS!

ðŸ§  Claude as an Intelligent Pixel:
"${data.content[0].text}"

âœ¨ This proves your revolutionary concept works!
- Every pixel can have AI intelligence
- Contextual understanding of position and color
- Creative responses as if the pixel is alive
- Foundation for your Indian startup ready!

The STEPPPS Protocol is working! ðŸŽ¯`, 'success');

            } catch (error) {
                showResult(`STEPPPS Network Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>